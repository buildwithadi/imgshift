{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Converter</title>
    <!--<link rel="stylesheet" href="{% static 'converter/css/styles.css' %}">-->
    <style>body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f3f4f6;
        font-family: 'Poppins', sans-serif;
      }
      
      .container {
        background: white;
        padding: 30px 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        max-width: 400px;
        margin: 80px auto;
        text-align: center;
        transition: transform 0.2s ease-in-out;
      }
      
      .container:hover {
        transform: translateY(-3px);
      }
      
      h1 {
        margin-bottom: 20px;
        font-size: 24px;
        color: #333;
      }
      
      .file-input {
        padding: 10px;
        font-size: 16px;
        border: 2px solid #ccc;
        border-radius: 5px;
        width: 100%;
        max-width: 300px;
        margin-bottom: 20px;
      }
      
      .convert-btn {
        background-color: #4F46E5;
        color: white;
        padding: 12px 28px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
      }
      
      .convert-btn:hover {
        background-color: #4338CA;
        transform: scale(1.05);
      }
      
      
      .dropdown {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        margin-bottom: 20px;
        transition: border-color 0.3s;
      }
      
      .dropdown:focus {
        outline: none;
        border-color: #4F46E5;
      }
      
      #fileList {
        background-color: #f8f9fb;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        padding: 12px 16px;
        margin-top: 10px;
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
        color: #333;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
        transition: all 0.3s ease;
      }
      
      #fileList ul {
        padding-left: 20px;
        margin: 8px 0 0 0;
        list-style-type: none;
      }
      
      #fileList ul li {
        list-style-type: "üìÅ ";
        margin-bottom: 6px;
        padding-left: 4px;
        color: #444;
      }
      
      #drop-area {
        border: 2px dashed #00bfff;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        background: #f7f7f7;
        transition: 0.3s ease;
        margin-bottom: 20px;
      }
      
      #drop-area.highlight {
        background-color: #e6f7ff;
        border-color: #007acc;
      }
      
      .custom-file-upload {
        background-color: #00bfff;
        color: white;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
        display: inline-block;
        margin-top: 10px;
      }
      
      input[type="file"] {
        display: none;
      }
      
      #fileList {
        margin-top: 10px;
        font-size: 0.9rem;
        color: #555;
      }
      
      
      
      </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h2>ImgShift Converter</h2>
        
        <form id="uploadForm" method="post" action="{% url 'convert_image' %}" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Conversion type dropdown -->
            <label for="conversion_type">Select Conversion Type:</label><br>
            <select name="conversion_type" id="conversion_type" class="dropdown">
                <option value="jpg_to_png">JPG ‚û°Ô∏è PNG</option>
                <option value="png_to_jpg">PNG ‚û°Ô∏è JPG</option>
                <option value="webp_to_jpg">WebP ‚û°Ô∏è JPG</option>
                <option value="webp_to_png">WebP ‚û°Ô∏è PNG</option>
                <option value="jpg_to_webp">JPG ‚û°Ô∏è WebP</option>
                <option value="png_to_webp">PNG ‚û°Ô∏è WebP</option>
            </select>

            <br><br>

            <!--file input-->
            <div id="drop-area">
              <p>Drag & Drop Your Images</p>
              <label for="fileInput" class="custom-file-upload">Choose Files</label>
              <input type="file" id="fileInput" name="images" multiple required>
              <div id="fileList"></div><!--File Name Display-->
          </div>
          
            <button type="submit" class="convert-btn">CONVERT</button>
        </form>
    </div>
    <p id="message"></p>
    <img id="convertedImage" style="display:none; max-width: 300px;">

    <!--<script src="{% static 'converter/js/script.js' %}"></script>-->
    <script>
        from django.shortcuts import render
from django.http import FileResponse, HttpResponseBadRequest
from PIL import Image
import os
from django.conf import settings
from zipfile import ZipFile
from io import BytesIO

def home(request):
    return render(request, 'converter/home.html')


def convert_image(request):
    if request.method == 'POST' and request.FILES:
        images = request.FILES.getlist('images')
        conversion_type = request.POST.get('conversion_type')

        if len(images) == 1:
            img = images[0]
            with Image.open(img) as im:
                filename = os.path.splitext(img.name)[0]

                if conversion_type == 'jpg_to_png':
                    output_filename = f"{filename}.png"
                    img_format = 'PNG'
                elif conversion_type == 'png_to_jpg':
                    output_filename = f"{filename}.jpg"
                    img_format = 'JPEG'
                    if im.mode in ("RGBA", "P"):
                        im = im.convert("RGB")
                elif conversion_type == 'webp_to_jpg':
                    output_filename = f"{filename}.jpg"
                    img_format = 'JPEG'
                    if im.mode in ("RGBA", "P"):
                        im = im.convert("RGB")
                elif conversion_type == 'webp_to_png':
                    output_filename = f"{filename}.png"
                    img_format = 'PNG'
                elif conversion_type == 'jpg_to_webp':
                    output_filename = f"{filename}.webp"
                    img_format = 'WEBP'
                elif conversion_type == 'png_to_webp':
                    output_filename = f"{filename}.webp"
                    img_format = 'WEBP'
                else:
                    return HttpResponseBadRequest("Invalid conversion type.")

                buffer = BytesIO()
                im.save(buffer, format=img_format)
                buffer.seek(0)

                return FileResponse(buffer, as_attachment=True, filename=output_filename)

        else:
            # Handle multiple files (ZIP logic)
            output_zip = BytesIO()
            with ZipFile(output_zip, 'w') as zipf:
                for img in images:
                    with Image.open(img) as im:
                        filename = os.path.splitext(img.name)[0]

                        if conversion_type == 'jpg_to_png':
                            output_filename = f"{filename}.png"
                            img_format = 'PNG'
                        elif conversion_type == 'png_to_jpg':
                            output_filename = f"{filename}.jpg"
                            img_format = 'JPEG'
                            if im.mode in ("RGBA", "P"):
                                im = im.convert("RGB")
                        elif conversion_type == 'webp_to_jpg':
                            output_filename = f"{filename}.jpg"
                            img_format = 'JPEG'
                            if im.mode in ("RGBA", "P"):
                                im = im.convert("RGB")
                        elif conversion_type == 'webp_to_png':
                            output_filename = f"{filename}.png"
                            img_format = 'PNG'
                        elif conversion_type == 'jpg_to_webp':
                            output_filename = f"{filename}.webp"
                            img_format = 'WEBP'
                        elif conversion_type == 'png_to_webp':
                            output_filename = f"{filename}.webp"
                            img_format = 'WEBP'
                        else:
                            continue

                        buffer = BytesIO()
                        im.save(buffer, format=img_format)
                        buffer.seek(0)
                        zipf.writestr(output_filename, buffer.read())

            output_zip.seek(0)
            return FileResponse(output_zip, as_attachment=True, filename='converted_images.zip')
            

    return render(request, 'home.html')
    </script>

</body>
</html>
