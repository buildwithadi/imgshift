{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Converter</title>
    <link rel="stylesheet" href="{% static 'converter/css/styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h2>ImgShift Converter</h2>
        
        <form id="uploadForm" method="post" action="{% url 'convert_image' %}" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Conversion type dropdown -->
            <label for="conversion_type">Select Conversion Type:</label><br>
            <select name="conversion_type" id="conversion_type" class="dropdown">
                <option value="jpg_to_png">JPG ‚û°Ô∏è PNG</option>
                <option value="png_to_jpg">PNG ‚û°Ô∏è JPG</option>
                <option value="webp_to_jpg">WebP ‚û°Ô∏è JPG</option>
                <option value="webp_to_png">WebP ‚û°Ô∏è PNG</option>
                <option value="jpg_to_webp">JPG ‚û°Ô∏è WebP</option>
                <option value="png_to_webp">PNG ‚û°Ô∏è WebP</option>
            </select>
            <br><br>

            <!--file input-->
            <div id="drop-area">
              <p>Drag & Drop Your Images</p>
              <label for="fileInput" class="custom-file-upload">Choose Files</label>
              <input type="file" id="fileInput" name="images" multiple required>
              <div id="fileList"></div><!--File Name Display-->
          </div>
          
            <button type="submit" class="convert-btn">CONVERT</button>
        </form>
    </div>
    <p id="message"></p>
    <img id="convertedImage" style="display:none; max-width: 300px;">

    <script>
        document.getElementById('fileInput').addEventListener('change', function () {
          const fileListDiv = document.getElementById('fileList');
          const files = this.files;
          
          if (files.length === 0) {
            fileListDiv.innerHTML = "<i>No files selected</i>";
            return;
          }
      
          let list = "<strong>Selected files:</strong><ul>";
          for (let i = 0; i < files.length; i++) {
            list += `<li>${files[i].name}</li>`;
          }
          list += "</ul>";
          fileListDiv.innerHTML = list;
        });

        let dropArea = document.getElementById('drop-area');
        let fileInput = document.getElementById('fileInput');
        let fileList = document.getElementById('fileList');

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, e => e.preventDefault());
          dropArea.addEventListener(eventName, e => e.stopPropagation());
        });

        // Highlight on drag
        ['dragenter', 'dragover'].forEach(eventName => {
          dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'));
        });
        ['dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'));
        });

        // Handle dropped files
        dropArea.addEventListener('drop', handleDrop);

        function handleDrop(e) {
          let dt = e.dataTransfer;
          let files = dt.files;
          fileInput.files = files; // Sets dropped files to file input
          displayFileNames(files);
        }

        // Display file names
        function displayFileNames(files) {
          fileList.innerHTML = "";
          Array.from(files).forEach(file => {
            fileList.innerHTML += `<div>üìÑ ${file.name}</div>`;
          });
        }

        // Also show names when selected using Choose File
        fileInput.addEventListener('change', () => {
          displayFileNames(fileInput.files);
        });

    </script>
</body>
</html>
